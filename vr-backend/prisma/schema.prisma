generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                   String     @id
  username             String     @unique
  email                String     @unique
  password             String?
  googleId             String?    @unique
  resetPasswordToken   String?
  resetPasswordExpires DateTime?
  clothing             Clothing[]
  folders              Folder[]
  occasions            Occasion[]
  outfits              Outfit[]
  roles                Role[]     @relation("UserRoles")
}

model Role {
  id    Int    @id @default(autoincrement())
  name  String @unique
  users User[] @relation("UserRoles")
}

model Clothing {
  id               String           @id @default(cuid())
  key              String           @unique
  url              String
  sourceUrl        String?
  name             String?
  type             String?
  brand            String?
  price            Float?
  color            String?
  season           String?
  notes            String?
  createdAt        DateTime         @default(now())
  updatedAt        DateTime         @updatedAt
  userId           String
  mode             String           @default("closet")
  isFavorite       Boolean          @default(false)
  originalImageUrl String?
  processingError  String?
  processingStatus String           @default("completed")
  aiGenerated      Boolean          @default(false)
  aiSuggestions    Json?
  category         String?
  favoriteToggles  Int              @default(0)
  lastViewedAt     DateTime?
  outfitCount      Int              @default(0)
  purchaseDate     DateTime?        @default(now())
  size             String?
  sourceDomain     String?
  tags             String[]         @default([])
  uploadMethod     String?
  userEdits        Json?
  viewCount        Int              @default(0)
  user             User             @relation(fields: [userId], references: [id], onDelete: Cascade)
  folderItems      FolderItem[]
  outfits          OutfitClothing[]
}

model Outfit {
  id             String           @id @default(uuid())
  name           String?
  occasion       String?
  season         String?
  notes          String?
  totalPrice     Float?
  createdAt      DateTime         @default(now())
  userId         String
  outerwearOnTop Boolean          @default(false)
  user           User             @relation(fields: [userId], references: [id], onDelete: Cascade)
  outfitClothing OutfitClothing[]
  occasions      Occasion[]       @relation("OutfitOccasions")
}

model OutfitClothing {
  outfitId    String
  clothingId  String
  x           Float    @default(0)
  y           Float    @default(0)
  scale       Float    @default(1)
  left        Float    @default(50)
  bottom      Float    @default(0)
  width       Float    @default(10)
  aspectRatio Float    @default(1.5)
  clothing    Clothing @relation(fields: [clothingId], references: [id], onDelete: Cascade)
  outfit      Outfit   @relation(fields: [outfitId], references: [id], onDelete: Cascade)

  @@id([outfitId, clothingId])
}

model Occasion {
  id              String   @id @default(uuid())
  name            String
  customThumbnail String?
  imageLayout     String?  @default("one-picture")
  previewImages   Json?
  createdAt       DateTime @default(now())
  userId          String
  user            User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  outfits         Outfit[] @relation("OutfitOccasions")
}

model Folder {
  id            String       @id @default(uuid())
  name          String
  description   String?
  isPublic      Boolean      @default(false)
  imageLayout   String?      @default("three-pictures")
  previewImages Json?
  createdAt     DateTime     @default(now())
  updatedAt     DateTime     @updatedAt
  userId        String
  user          User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  items         FolderItem[]
}

model FolderItem {
  id         String   @id @default(uuid())
  folderId   String
  clothingId String
  addedAt    DateTime @default(now())
  clothing   Clothing @relation(fields: [clothingId], references: [id], onDelete: Cascade)
  folder     Folder   @relation(fields: [folderId], references: [id], onDelete: Cascade)

  @@unique([folderId, clothingId])
}
